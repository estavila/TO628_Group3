---
title: "OxFord COVID-19 Data Exploration"
output: html_document
author: "Estefania Avila, Meitong Hu, Egle Klekere, Alla Polishchuk, Jingjing Zhang"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data Source & Summary

OXFORD COVID-19 GOVERNMENT RESPONSE TRACKER: aims to track and compare government responses to the coronavirus outbreak worldwide rigorously and consistently. We can analyze how specific government measures affect outcomes in terms of COVID cases and deaths.
https://www.bsg.ox.ac.uk/research/research-projects/oxford-covid-19-government-response-tracker

#### 13 Measures Tracked by Oxford:

* S1_School closing
* S2_Workplace closing
* S3_Cancel public events
* S4_Close public transport
* S5_Public information campaigns
* S6_Restrictions on internal movement
* S7_International travel controls
* S8_Fiscal measures
* S9_Monetary measures
* S10_Emergency investment in health care
* S11_Investment in Vaccines
* S12_Testing framework
* S13_Contact tracing

OxCGRT collects publicly available information on 13 indicators of government response (S1-S13). Nine of the indicators (S1-S7, S12 and S13) take policies such as school closures, travel bans, etc. are recorded on an ordinal scale; the remainder (S8-S11) are financial indicators such as fiscal or monetary measures.

#### Other data in dataset:

* ConfirmedCases
* ConfirmedDeaths
* StringencyIndex

Oxford has a StringencyIndex that measures how stringent each government has reacted. I thought, maybe we can introduce Proactivity index - how many measures country has introduced before first ConfirmedCase and first ConfirmedDeath. I assume this affects the outcomes as well. Then one of our questiond would be: What has been more effective stringency or proactivity?

Interesting analysis of Oxford data:
https://www.bsg.ox.ac.uk/research/research-projects/oxford-covid-19-government-response-tracker?ref=researchstash

## Data Exploration
### Read File
Read file in.Noticed it has a lot of "Notes" columns used to supply source of change in variable.

```{r ,}
data = read.csv("OxCGRT_Download_080420_161822_Full.csv")
names(data)
```

### Filter DataFrame
We removed those columns to facilitate initial data exploration.

```{r ,}
df = subset( data, select = -c(grep( "Notes" , names( data ) )) )
df = subset( df, select = -c(grep( "General" , names( df ) )) )
names(df)
#str(df)
#summary(df)

```

```{r ,}
###
df$Date<-data.frame(as.Date(as.character(df$Date),"%Y%m%d")) #converting integer data frame to date, then we can calculate date differences (Updated Date (20200408) - Date of closing school, workplace etc.)


# the two lines below didn't run for me...did you use any specific libraries?

#df_0408<-filter(df,df$Date=="2020-04-08") #using the data on date 20200408
#df_0408<-arrange(df_0408,desc(ConfirmedCases, ConfirmedDeaths))#arranging in a decreasing order of confirmed cases and confirmed deaths
#df_0408_top30<-head(df_0408,30) #If we decide to use all 118 country data, delete this line.

```

#### Get Top 30 Countries
Top 30 is based on the number of Confirmed Cases on 04-08-2020. This can be modified.
```{r ,}
# look at the rows with the date 2020-04-08
data_0408 = subset(data, data$Date == 20200408)
# order data in descending order based on num cases and deaths
data_0408 = data_0408[order(-data_0408$ConfirmedCases, -data_0408$ConfirmedDeaths),]

# take the levels of first 30 rows of the CountryName column
top30 = levels(factor(head(data_0408,30)$CountryName))
top30
```

#### Filter data to only include Top 30 Countries
```{r ,}
# take the subset of data related to top 30 countries
df_top30 = subset(data, CountryName %in% top30)
df_top30 = subset(df_top30, df_top30$Date <= 20200408)
# drop unused levels from all factors
df_top30[] = lapply(df_top30, function(x) if(is.factor(x)) factor(x) else x)

# find columns with Notes or General in name
Notes = c(grep( "Notes" , names( df_top30 ) ))
General = c(grep( "General" , names( df_top30 ) ))
# save notes and general as separate df's
df_notes = subset(df_top30, select = Notes )
df_general = subset( df_top30, select = General )
# remove notes and general columns from main df
df_top30 = subset( df_top30, select = -c(Notes, General))

names(df_top30)
#summary(df_top30)
```

### Explore Notes Columns
To explore the notes data, we just peaked into one of the columns to see what kind of announcements they are using.
```{r ,}
names(df_notes)
str(df_notes)
levels(df_notes$S1_Notes)[1:5]
```

### Explore Genral Columns
To explore the general, we just peaked into one of the columns to see what kind of announcements they are using.
```{r ,}
names(df_general)
str(df_general)
levels(df_general$S1_IsGeneral)[1:20]
```

## Potential Questions to Explore:

* Which measures were most effective for which countries?
* Predict number of cases? deaths? 